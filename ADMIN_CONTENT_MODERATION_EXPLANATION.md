# Content Moderation - Flagged Messages 说明

## 概述
Content Moderation 中的 "Flagged Messages" 是**自动检测系统**捕获的违规消息，不是用户举报的。

## 工作原理

### 1. 自动检测
系统在用户发送消息时自动检测以下违规类型：
- **spam**（垃圾信息）
- **hate_speech**（仇恨言论）
- **harassment**（骚扰）
- **inappropriate**（不适当内容）
- **advertising**（广告）
- **scam**（诈骗）

### 2. 检测规则
- **上下文感知**：系统能区分正常对话和实际违规
  - 常见表达（如 "fuck", "shit", "kill" 在故事中）会被忽略
  - 白名单覆盖常见短语
  - 故事上下文降低严重程度
  
- **隐私保护**：
  - **只检测公开房间的消息**
  - 私聊不检测（用户可以自行屏蔽）

### 3. 严重程度分级
- **critical**（严重）：需要立即处理
- **high**（高）：需要管理员关注
- **medium**（中）：可选择性处理
- **low**（低）：信息记录

### 4. 自动处理
根据严重程度和用户历史违规记录：
- **critical + 3次违规** → 自动封禁
- **critical < 3次** → 自动禁言
- **high + 3次违规** → 自动禁言
- **high < 3次** → 警告
- **medium + 5次违规** → 警告
- **low** → 仅记录

### 5. 管理员控制
系统默认**禁用**，需要管理员在后台启用：
- 访问 Admin Panel → Moderation Settings
- 可以单独控制每种检测类型
- 可以设置严格模式

## 数据来源
Flagged Messages 显示的数据来自：
- `localStorage` 中的 `chatsphere_violation_history`
- 每条消息被检测到违规时会自动保存
- 管理员可以查看、删除、警告用户

## 如何管理
1. **查看详情**：点击消息查看完整内容
2. **删除消息**：删除违规消息
3. **警告用户**：向用户发送警告通知
4. **统计信息**：查看违规类型和严重程度分布

## 注意事项
⚠️ 系统默认禁用，需要管理员手动开启
⚠️ 实时流量较低时建议关闭自动监听
⚠️ 私聊消息不受监控（用户可自行屏蔽）

